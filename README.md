# VPS Monitor - è½»é‡çº§æœåŠ¡å™¨ç›‘æ§æ¢é’ˆ

ä¸€ä¸ªè½»é‡çº§çš„ VPS ç›‘æ§æ¢é’ˆç³»ç»Ÿï¼Œæ”¯æŒéƒ¨ç½²åˆ° **Cloudflare Pages**ï¼ˆæ¨èï¼‰æˆ– Vercelã€‚

![Screenshot](./screenshot.png)

![VPS Monitor](https://img.shields.io/badge/VPS-Monitor-blue)
![React](https://img.shields.io/badge/React-18-61DAFB)
![TypeScript](https://img.shields.io/badge/TypeScript-5-3178C6)
![Tailwind CSS](https://img.shields.io/badge/Tailwind-3-38B2AC)
![Cloudflare](https://img.shields.io/badge/Cloudflare-Pages-F38020)

## ğŸ¯ ç‰¹æ€§äº®ç‚¹

- âš¡ **ä¸€é”®éƒ¨ç½²** - éƒ¨ç½²åˆ° Cloudflare Pagesï¼Œæ— éœ€æœåŠ¡å™¨
- ğŸŒ **IP è‡ªåŠ¨å®šä½** - è‡ªåŠ¨è¯†åˆ« VPS æ‰€åœ¨åœ°åŒºå’Œè¿è¥å•†
- ğŸ” **Token è®¤è¯** - å®‰å…¨çš„æ•°æ®ä¸ŠæŠ¥æœºåˆ¶
- ğŸ“± **å“åº”å¼è®¾è®¡** - å®Œç¾é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- ğŸŒ“ **æš—è‰²æ¨¡å¼** - æ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢
- ğŸ”„ **å®æ—¶ç›‘æ§** - 2 ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®ï¼ˆå¯é…ç½®ï¼‰
- ğŸ”” **æ™ºèƒ½éšè—** - ç¦»çº¿è¶… 1 åˆ†é’Ÿçš„èŠ‚ç‚¹è‡ªåŠ¨éšè—

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æœåŠ¡å™¨ç›‘æ§
- ğŸ–¥ï¸ **èŠ‚ç‚¹åç§°** - æ”¯æŒè‡ªå®šä¹‰æˆ–è‡ªåŠ¨è¯†åˆ«ï¼ˆåŸå¸‚ + ISPï¼‰
- ğŸŒ **ä½ç½®æ˜¾ç¤º** - å›½æ—— emoji ç›´è§‚å±•ç¤ºï¼ŒIP è‡ªåŠ¨å®šä½
- â±ï¸ **å¼€æœºæ—¶é—´** - æ˜¾ç¤ºæœåŠ¡å™¨è¿è¡Œæ—¶é•¿
- ğŸ”Œ **åè®®ç±»å‹** - æ”¯æŒ KVM/OpenVZ ç­‰è™šæ‹ŸåŒ–ç±»å‹
- ğŸ“Š **ç³»ç»Ÿè´Ÿè½½** - 1/5/15 åˆ†é’Ÿè´Ÿè½½ç›‘æ§
- ğŸ§ **æ“ä½œç³»ç»Ÿ** - è‡ªåŠ¨è¯†åˆ«å‘è¡Œç‰ˆ

### èµ„æºç›‘æ§
- ğŸ’» **CPU ä½¿ç”¨ç‡** - å®æ—¶å¤„ç†å™¨å ç”¨æƒ…å†µ
- ğŸ§  **å†…å­˜ä½¿ç”¨** - å†…å­˜ä½¿ç”¨é‡åŠç™¾åˆ†æ¯”
- ğŸ’¾ **ç¡¬ç›˜ä½¿ç”¨** - ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
- ğŸŒ **IPv6 æ”¯æŒ** - è‡ªåŠ¨æ£€æµ‹ IPv6 è¿æ¥çŠ¶æ€

### ç½‘ç»œæµé‡
- ğŸ“ˆ **å®æ—¶é€Ÿåº¦** - å½“å‰ä¸‹è½½/ä¸Šä¼ é€Ÿåº¦
- ğŸ“… **æœˆæµé‡** - æœˆåº¦æµé‡ä½¿ç”¨ç»Ÿè®¡ï¼ˆæ”¯æŒè‡ªå®šä¹‰é‡ç½®æ—¥ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆCloudflare Pagesï¼‰

### ç¬¬ 1 æ­¥ï¼šFork ä»“åº“

ç‚¹å‡»å³ä¸Šè§’ **Fork** æŒ‰é’®ï¼ŒFork åˆ°ä½ çš„ GitHub è´¦å·ã€‚

### ç¬¬ 2 æ­¥ï¼šåˆ›å»º KV å‘½åç©ºé—´

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. è¿›å…¥ **Workers & Pages** â†’ **KV**
3. ç‚¹å‡» **Create a namespace**
4. è¾“å…¥åç§°ï¼š`VPS_KV`ï¼ˆåç§°å¯è‡ªå®šä¹‰ï¼‰

### ç¬¬ 3 æ­¥ï¼šåˆ›å»º Pages é¡¹ç›®

1. è¿›å…¥ **Workers & Pages** â†’ **Create application** â†’ **Pages**
2. ç‚¹å‡» **Connect to Git**ï¼Œé€‰æ‹©ä½  Fork çš„ä»“åº“
3. é…ç½®æ„å»ºè®¾ç½®ï¼š

| è®¾ç½®é¡¹ | å€¼ |
|-------|---|
| Framework preset | None |
| Build command | `npm run build` |
| Build output directory | `dist` |
| Root directory | ï¼ˆç•™ç©ºï¼‰ |

> âš ï¸ **é‡è¦**ï¼šéƒ¨ç½²å‘½ä»¤ç•™ç©ºï¼Œä¸è¦å¡«å†™ä»»ä½• wrangler å‘½ä»¤ï¼

### ç¬¬ 4 æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨éƒ¨ç½²é¡µé¢ï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|---|------|
| `VPS_AUTH_TOKEN` | `your-secret-token` | Agent è®¤è¯å¯†ç  |

> âš ï¸ **æ³¨æ„**ï¼šä¸è¦ä½¿ç”¨ `API_TOKEN`ï¼Œè¿™æ˜¯ Cloudflare ä¿ç•™å˜é‡åï¼

### ç¬¬ 5 æ­¥ï¼šç»‘å®š KV å‘½åç©ºé—´

**è¿™ä¸€æ­¥æœ€é‡è¦ï¼**

åœ¨éƒ¨ç½²é¡µé¢ï¼Œæ‰¾åˆ° **Functions** â†’ **KV namespace bindings**ï¼š

| å˜é‡å | KV å‘½åç©ºé—´ |
|--------|------------|
| `VPS_KV` | é€‰æ‹©ç¬¬ 2 æ­¥åˆ›å»ºçš„å‘½åç©ºé—´ |

### ç¬¬ 6 æ­¥ï¼šéƒ¨ç½²

ç‚¹å‡» **Save and Deploy**ï¼Œç­‰å¾… 2-3 åˆ†é’Ÿã€‚

éƒ¨ç½²æˆåŠŸåï¼Œè®¿é—®ä½ çš„ç«™ç‚¹ï¼š`https://xxx.pages.dev`

---

## ğŸ“¡ å®‰è£… Agent

åœ¨ä½ çš„ VPS ä¸Šè¿è¡Œï¼š

```bash
curl -fsSL https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/avpsmonitor/main/agent/install.sh | bash -s -- \
  https://ä½ çš„é¡¹ç›®.pages.dev \
  your-secret-token \
  vps-node-01
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| ç¬¬ 1 ä¸ª | ä½ çš„ Pages ç«™ç‚¹åœ°å€ | `https://vps.pages.dev` |
| ç¬¬ 2 ä¸ª | `VPS_AUTH_TOKEN` çš„å€¼ | `your-secret-token` |
| ç¬¬ 3 ä¸ª | èŠ‚ç‚¹ IDï¼ˆæ¯å° VPS ä¸åŒï¼‰ | `hk-01` |

### Agent ç®¡ç†

```bash
# æŸ¥çœ‹çŠ¶æ€
systemctl status vps-agent

# æŸ¥çœ‹æ—¥å¿—
journalctl -u vps-agent -f

# é‡å¯æœåŠ¡
systemctl restart vps-agent

# å¸è½½
curl -fsSL https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/avpsmonitor/main/agent/uninstall.sh | bash
```

---

## âš™ï¸ ç¯å¢ƒå˜é‡

### Cloudflare Pages

| å˜é‡å | å¿…å¡« | è¯´æ˜ |
|--------|------|------|
| `VPS_AUTH_TOKEN` | âœ… | Agent è®¤è¯ Token |
| `VPS_SERVERS` | âŒ | é¢„é…ç½®æœåŠ¡å™¨åˆ—è¡¨ |
| `REFRESH_INTERVAL` | âŒ | å‰ç«¯åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ 2000 |

### KV ç»‘å®š

| ç»‘å®šåç§° | å¿…å¡« | è¯´æ˜ |
|---------|------|------|
| `VPS_KV` | âœ… | Workers KV å‘½åç©ºé—´ |

### VPS_SERVERS æ ¼å¼

```
VPS_SERVERS=èŠ‚ç‚¹ID:æ˜¾ç¤ºåç§°:å›½å®¶ä»£ç :ä½ç½®:åˆ°æœŸæ—¥æœŸ:æµé‡é‡ç½®æ—¥:æœˆæµé‡
```

**ç¤ºä¾‹**ï¼š
```
VPS_SERVERS=hk-01:é¦™æ¸¯ CN2:HK:Hong Kong:2025-12-31:1:1t,jp-01:ä¸œäº¬:JP:Tokyo:2025-06-15:15:3TB
```

---

## ğŸ—ï¸ æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VPS 1     â”‚         â”‚       Cloudflare Pages           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  POST   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚  Agent  â”‚â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚ /api/reportâ”‚â”€â”€â”€â–ºâ”‚ Workers  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚  â”‚  (ä¸ŠæŠ¥API) â”‚    â”‚   KV     â”‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   VPS 2     â”‚         â”‚                         â”‚        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚        â”‚
â”‚ â”‚  Agent  â”‚â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚ /api/nodes â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚  â”‚  (æŸ¥è¯¢API) â”‚                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚   VPS N     â”‚         â”‚        â”‚                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚ â”‚  Agent  â”‚â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚   React    â”‚  â—„â”€â”€ ç”¨æˆ·è®¿é—®    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚  â”‚   å‰ç«¯     â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
avpsmonitor/
â”œâ”€â”€ functions/            # Cloudflare Pages Functions
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ nodes.js      # GET /api/nodes - è·å–æ‰€æœ‰èŠ‚ç‚¹
â”‚       â””â”€â”€ report.js     # POST /api/report - Agent æ•°æ®ä¸ŠæŠ¥
â”œâ”€â”€ api/                  # Vercel Serverless å‡½æ•°ï¼ˆå¤‡ç”¨ï¼‰
â”‚   â”œâ”€â”€ nodes.ts
â”‚   â””â”€â”€ report.ts
â”œâ”€â”€ agent/                # VPS ç›‘æ§ Agent
â”‚   â”œâ”€â”€ agent.sh          # Shell ç‰ˆæœ¬ Agent
â”‚   â”œâ”€â”€ install.sh        # ä¸€é”®å®‰è£…è„šæœ¬
â”‚   â””â”€â”€ uninstall.sh      # å¸è½½è„šæœ¬
â”œâ”€â”€ src/                  # React å‰ç«¯æºç 
â”œâ”€â”€ dist/                 # æ„å»ºè¾“å‡º
â””â”€â”€ package.json
```

---

## â“ å¸¸è§é—®é¢˜

### Q: éƒ¨ç½²åé¡µé¢æ˜¾ç¤º "hello world"ï¼Ÿ

**A**: Functions æ²¡æœ‰è¢«æ­£ç¡®è¯†åˆ«ã€‚æ£€æŸ¥ï¼š
1. ç¡®ä¿ `functions/api/` ç›®å½•å­˜åœ¨
2. ç¡®ä¿ Root directory ç•™ç©º
3. ç¡®ä¿æ²¡æœ‰ä½¿ç”¨ wrangler éƒ¨ç½²å‘½ä»¤

### Q: æŠ¥é”™ "Workers-specific command in Pages project"ï¼Ÿ

**A**: ä¸è¦åœ¨éƒ¨ç½²å‘½ä»¤ä¸­å¡«å†™ `wrangler` ç›¸å…³å‘½ä»¤ã€‚Git é›†æˆçš„ Pages é¡¹ç›®ä¼šè‡ªåŠ¨å¤„ç† Functionsã€‚

### Q: API è¿”å› "KV not configured"ï¼Ÿ

**A**: KV ç»‘å®šæœªç”Ÿæ•ˆã€‚æ£€æŸ¥ï¼š
1. åœ¨ **Settings** â†’ **Functions** â†’ **KV namespace bindings** ä¸­æ·»åŠ ç»‘å®š
2. å˜é‡åå¿…é¡»æ˜¯ `VPS_KV`
3. æ·»åŠ åéœ€è¦**é‡æ–°éƒ¨ç½²**

### Q: Agent æŠ¥é”™ "401 Unauthorized"ï¼Ÿ

**A**: Token ä¸åŒ¹é…ã€‚ç¡®ä¿ï¼š
1. Cloudflare ç¯å¢ƒå˜é‡ä½¿ç”¨ `VPS_AUTH_TOKEN`ï¼ˆä¸æ˜¯ `API_TOKEN`ï¼‰
2. Agent å®‰è£…æ—¶ä½¿ç”¨çš„ Token ä¸ç¯å¢ƒå˜é‡ä¸€è‡´

### Q: æƒ³éƒ¨ç½²åˆ° Vercelï¼Ÿ

**A**: å¯ä»¥ï¼å‚è€ƒ `/api` ç›®å½•ä¸‹çš„ Vercel å‡½æ•°ã€‚éœ€è¦é…ç½® Upstash Redis ä½œä¸ºå­˜å‚¨ã€‚

---

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼ï¼ˆä½¿ç”¨ Demo æ•°æ®ï¼‰
npm run dev

# æ„å»º
npm run build
```

---

## ğŸ“ License

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

Made with â¤ï¸ | Powered by Cloudflare Pages + Workers KV
